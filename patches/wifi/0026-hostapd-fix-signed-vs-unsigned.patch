From 522e857205103b33b221e761a93b89ad408f040a Mon Sep 17 00:00:00 2001
From: John Crispin <john@phrozen.org>
Date: Thu, 20 Jul 2023 07:09:30 +0200
Subject: [PATCH] hostapd: fix signed vs unsigned

Signed-off-by: John Crispin <john@phrozen.org>
---
 .../services/hostapd/patches/999-s8-u8.patch  | 22 +++++++++++++++++++
 1 file changed, 22 insertions(+)
 create mode 100644 package/network/services/hostapd/patches/999-s8-u8.patch

diff --git a/package/network/services/hostapd/patches/999-s8-u8.patch b/package/network/services/hostapd/patches/999-s8-u8.patch
new file mode 100644
index 0000000000..f43aa91861
--- /dev/null
+++ b/package/network/services/hostapd/patches/999-s8-u8.patch
@@ -0,0 +1,22 @@
+Index: hostapd-2023-06-22-599d00be/src/drivers/driver_nl80211.c
+===================================================================
+--- hostapd-2023-06-22-599d00be.orig/src/drivers/driver_nl80211.c
++++ hostapd-2023-06-22-599d00be/src/drivers/driver_nl80211.c
+@@ -7686,7 +7686,7 @@ static int get_sta_handler(struct nl_msg
+ 		[NL80211_STA_INFO_BEACON_SIGNAL_AVG] = { .type = NLA_U8},
+ 		[NL80211_STA_INFO_RX_DURATION] = { .type = NLA_U64 },
+ 		[NL80211_STA_INFO_ACK_SIGNAL] = { .type = NLA_U8 },
+-		[NL80211_STA_INFO_ACK_SIGNAL_AVG] = { .type = NLA_S8 },
++		[NL80211_STA_INFO_ACK_SIGNAL_AVG] = { .type = NLA_U8 },
+ 		[NL80211_STA_INFO_RX_MPDUS] = { .type = NLA_U32 },
+ 		[NL80211_STA_INFO_FCS_ERROR_COUNT] = { .type = NLA_U32 },
+ 		[NL80211_STA_INFO_TX_DURATION] = { .type = NLA_U64 },
+@@ -7792,7 +7792,7 @@ static int get_sta_handler(struct nl_msg
+ 	}
+ 	if (stats[NL80211_STA_INFO_ACK_SIGNAL_AVG])
+ 		data->avg_ack_signal =
+-			nla_get_s8(stats[NL80211_STA_INFO_ACK_SIGNAL_AVG]);
++			nla_get_u8(stats[NL80211_STA_INFO_ACK_SIGNAL_AVG]);
+ 	if (stats[NL80211_STA_INFO_RX_MPDUS])
+ 		data->rx_mpdus = nla_get_u32(stats[NL80211_STA_INFO_RX_MPDUS]);
+ 	if (stats[NL80211_STA_INFO_FCS_ERROR_COUNT])
-- 
2.34.1

